(this.webpackJsonp=this.webpackJsonp||[]).push([[97],{bjR0:function(t,e,i){"use strict";i("ZzK0"),i("z6RN"),i("BzOf"),i("byxs");var o=i("yWhq"),n=i("ewH8"),s=i("NmEs"),a=(i("3UXl"),i("iyoE"),i("Yyc1")),l=i("koWC"),c=i("LLbv"),r=i("qPgm"),d=i("/lV4");const u={notificationTitles:{participating:Object(d.g)("NotificationLevel|Participate"),mention:Object(d.g)("NotificationLevel|On mention"),watch:Object(d.g)("NotificationLevel|Watch"),global:Object(d.g)("NotificationLevel|Global"),disabled:Object(d.g)("NotificationLevel|Disabled"),custom:Object(d.g)("NotificationLevel|Custom")},notificationTooltipTitle:Object(d.a)("Notification setting - %{notification_title}"),notificationDescriptions:{participating:Object(d.a)("You will only receive notifications for threads you have participated in"),mention:Object(d.a)("You will receive notifications only for comments in which you were @mentioned"),watch:Object(d.a)("You will receive notifications for any activity"),disabled:Object(d.a)("You will not get any notifications via email"),global:Object(d.a)("Use your global notification setting"),custom:Object(d.a)("You will only receive notifications for the events you choose"),owner_disabled:Object(d.a)("Notifications have been disabled by the project or group owner")},updateNotificationLevelErrorMessage:Object(d.a)("An error occurred while updating the notification settings. Please try again."),loadNotificationLevelErrorMessage:Object(d.a)("An error occurred while loading the notification settings. Please try again."),customNotificationsModal:{title:Object(d.a)("Custom notification events"),bodyTitle:Object(d.a)("Notification events"),bodyMessage:Object(d.a)("Custom notification levels are the same as participating levels. With custom notification levels you will also receive notifications for select events. To find out more, check out %{notificationLinkStart}notification emails%{notificationLinkEnd}.")},eventNames:{change_reviewer_merge_request:Object(d.g)("NotificationEvent|Change reviewer merge request"),close_issue:Object(d.g)("NotificationEvent|Close issue"),close_merge_request:Object(d.g)("NotificationEvent|Close merge request"),failed_pipeline:Object(d.g)("NotificationEvent|Failed pipeline"),fixed_pipeline:Object(d.g)("NotificationEvent|Fixed pipeline"),issue_due:Object(d.g)("NotificationEvent|Issue due"),merge_merge_request:Object(d.g)("NotificationEvent|Merge merge request"),moved_project:Object(d.g)("NotificationEvent|Moved project"),new_epic:Object(d.g)("NotificationEvent|New epic"),new_issue:Object(d.g)("NotificationEvent|New issue"),new_merge_request:Object(d.g)("NotificationEvent|New merge request"),new_note:Object(d.g)("NotificationEvent|New note"),new_release:Object(d.g)("NotificationEvent|New release"),push_to_merge_request:Object(d.g)("NotificationEvent|Push to merge request"),reassign_issue:Object(d.g)("NotificationEvent|Reassign issue"),reassign_merge_request:Object(d.g)("NotificationEvent|Reassign merge request"),reopen_issue:Object(d.g)("NotificationEvent|Reopen issue"),reopen_merge_request:Object(d.g)("NotificationEvent|Reopen merge request"),merge_when_pipeline_succeeds:Object(d.g)("NotificationEvent|Merge when pipeline succeeds"),success_pipeline:Object(d.g)("NotificationEvent|Successful pipeline"),approver:Object(d.g)("NotificationEvent|Added as approver")}};var p=i("1cpz"),f=i("30su"),m=i("MV2A"),g=i("FkSe"),v=i("l5WF"),h=i("SeSR"),b={name:"CustomNotificationsModal",components:{GlModal:p.a,GlSprintf:f.a,GlLink:m.a,GlLoadingIcon:g.a,GlFormGroup:v.a,GlFormCheckbox:h.a},inject:{projectId:{default:null},groupId:{default:null},helpPagePath:{default:""}},model:{prop:"visible",event:"change"},props:{modalId:{type:String,required:!1,default:"custom-notifications-modal"},visible:{type:Boolean,required:!1,default:!1}},data:()=>({isLoading:!1,events:[]}),methods:{open(){this.$refs.modal.show()},buildEvents(t){var e=this;return Object.keys(t).map((function(i){return{id:i,enabled:Boolean(t[i]),name:e.$options.i18n.eventNames[i]||"",loading:!1}}))},async onOpen(){this.events.length||await this.loadNotificationSettings()},async loadNotificationSettings(){this.isLoading=!0;try{const{data:{events:t}}=await r.b.getNotificationSettings(this.projectId,this.groupId);this.events=this.buildEvents(t)}catch(t){this.$toast.show(this.$options.i18n.loadNotificationLevelErrorMessage)}finally{this.isLoading=!1}},async updateEvent(t,e){const i=this.events.findIndex((function(t){return t.id===e.id}));this.$set(this.events,i,{...this.events[i],loading:!0});try{const{data:{events:i}}=await r.b.updateNotificationSettings(this.projectId,this.groupId,{[e.id]:t});this.events=this.buildEvents(i)}catch(t){this.$toast.show(this.$options.i18n.updateNotificationLevelErrorMessage)}}},i18n:u},N=i("tBpV"),w=Object(N.a)(b,(function(){var t=this,e=t._self._c;return e("gl-modal",t._g({ref:"modal",attrs:{visible:t.visible,"modal-id":t.modalId,title:t.$options.i18n.customNotificationsModal.title},on:{show:t.onOpen}},t.$listeners),[e("div",{staticClass:"container-fluid"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-lg-4"},[e("h4",{staticClass:"gl-mt-0",attrs:{"data-testid":"modalBodyTitle"}},[t._v("\n          "+t._s(t.$options.i18n.customNotificationsModal.bodyTitle)+"\n        ")]),t._v(" "),e("gl-sprintf",{attrs:{message:t.$options.i18n.customNotificationsModal.bodyMessage},scopedSlots:t._u([{key:"notificationLink",fn:function({content:i}){return[e("gl-link",{attrs:{href:t.helpPagePath,target:"_blank"}},[t._v(t._s(i))])]}}])})],1),t._v(" "),e("div",{staticClass:"col-lg-8"},[t.isLoading?e("gl-loading-icon",{staticClass:"gl-mt-3",attrs:{size:"lg"}}):t._l(t.events,(function(i){return e("gl-form-group",{key:i.id},[e("gl-form-checkbox",{attrs:{"data-testid":"notification-setting-"+i.id},on:{change:function(e){return t.updateEvent(e,i)}},model:{value:i.enabled,callback:function(e){t.$set(i,"enabled",e)},expression:"event.enabled"}},[e("strong",[t._v(t._s(i.name))]),i.loading?e("gl-loading-icon",{staticClass:"gl-ml-2",attrs:{size:"sm",inline:!0}}):t._e()],1)],1)}))],2)])])])}),[],!1,null,null,null).exports,j={name:"NotificationsDropdownItem",components:{GlDropdownItem:i("wP8z").a},props:{level:{type:String,required:!0},title:{type:String,required:!0},description:{type:String,required:!0},notificationLevel:{type:String,required:!0}},computed:{isActive(){return this.notificationLevel===this.level}}},y=Object(N.a)(j,(function(){var t=this,e=t._self._c;return e("gl-dropdown-item",{class:{"is-active":t.isActive},attrs:{"is-check-item":"","is-checked":t.isActive},on:{click:function(e){return t.$emit("item-selected",t.level)}}},[e("div",{staticClass:"gl-display-flex gl-flex-direction-column"},[e("span",{staticClass:"gl-font-weight-bold"},[t._v(t._s(t.title))]),t._v(" "),e("span",{staticClass:"gl-text-gray-500"},[t._v(t._s(t.description))])])])}),[],!1,null,null,null).exports,_={name:"NotificationsDropdown",components:{GlDropdown:a.a,GlDropdownDivider:l.a,NotificationsDropdownItem:y,CustomNotificationsModal:w},directives:{GlTooltip:c.a},inject:{containerClass:{default:""},disabled:{default:!1},dropdownItems:{default:[]},buttonSize:{default:"medium"},initialNotificationLevel:{default:""},projectId:{default:null},groupId:{default:null},showLabel:{default:!1},noFlip:{default:!1}},data(){return{selectedNotificationLevel:this.initialNotificationLevel,isLoading:!1,notificationsModalVisible:!1}},computed:{notificationLevels(){var t=this;return this.dropdownItems.map((function(e){return{level:e,title:t.$options.i18n.notificationTitles[e]||"",description:t.$options.i18n.notificationDescriptions[e]||""}}))},isCustomNotification(){return"custom"===this.selectedNotificationLevel},buttonIcon(){return this.isLoading?null:"disabled"===this.selectedNotificationLevel?"notifications-off":"notifications"},buttonText(){return this.showLabel?this.$options.i18n.notificationTitles[this.selectedNotificationLevel]:null},buttonTooltip(){const t=this.$options.i18n.notificationTitles[this.selectedNotificationLevel]||this.selectedNotificationLevel;return this.disabled?this.$options.i18n.notificationDescriptions.owner_disabled:Object(d.h)(this.$options.i18n.notificationTooltipTitle,{notification_title:t})}},methods:{openNotificationsModal(){this.isCustomNotification&&(this.notificationsModalVisible=!0)},selectItem(t){t!==this.selectedNotificationLevel&&this.updateNotificationLevel(t)},async updateNotificationLevel(t){this.isLoading=!0;try{await r.b.updateNotificationSettings(this.projectId,this.groupId,{level:t}),this.selectedNotificationLevel=t,this.openNotificationsModal()}catch(t){this.$toast.show(this.$options.i18n.updateNotificationLevelErrorMessage)}finally{this.isLoading=!1}}},customLevel:"custom",i18n:u,modalId:"custom-notifications-modal"},O=Object(N.a)(_,(function(){var t=this,e=t._self._c;return e("div",{class:t.containerClass},[e("gl-dropdown",{directives:[{name:"gl-tooltip",rawName:"v-gl-tooltip",value:{title:t.buttonTooltip},expression:"{ title: buttonTooltip }"}],attrs:{"data-testid":"notification-dropdown",size:t.buttonSize,icon:t.buttonIcon,loading:t.isLoading,disabled:t.disabled,split:t.isCustomNotification,text:t.buttonText,"no-flip":t.noFlip},on:{click:t.openNotificationsModal}},[t._l(t.notificationLevels,(function(i){return e("notifications-dropdown-item",{key:i.level,attrs:{level:i.level,title:i.title,description:i.description,"notification-level":t.selectedNotificationLevel},on:{"item-selected":t.selectItem}})})),t._v(" "),e("gl-dropdown-divider"),t._v(" "),e("notifications-dropdown-item",{key:t.$options.customLevel,attrs:{level:t.$options.customLevel,title:t.$options.i18n.notificationTitles.custom,description:t.$options.i18n.notificationDescriptions.custom,"notification-level":t.selectedNotificationLevel},on:{"item-selected":t.selectItem}})],2),t._v(" "),e("custom-notifications-modal",{attrs:{"modal-id":t.$options.modalId},model:{value:t.notificationsModalVisible,callback:function(e){t.notificationsModalVisible=e},expression:"notificationsModalVisible"}})],1)}),[],!1,null,null,null).exports,L={components:{ListboxInput:i("uNj4").a},inject:["label","name","emails","emptyValueText","value","disabled","placement"],data(){return{selected:this.value}},computed:{options(){return[{value:"",text:this.emptyValueText},...this.emails.map((function(t){return{text:t,value:t}}))]}},methods:{async onSelect(){await this.$nextTick(),this.$el.closest("form").submit()}}},x=Object(N.a)(L,(function(){var t=this;return(0,t._self._c)("listbox-input",{attrs:{label:t.label,name:t.name,items:t.options,disabled:t.disabled,placement:t.placement,"fluid-width":""},on:{select:t.onSelect},model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}})}),[],!1,null,null,null).exports;n.default.use(o.a);e.a=function(){!function(){const t="js-notification-email-listbox-input";[...document.querySelectorAll("."+t)].forEach((function(e,i){const{label:o,name:a,emptyValueText:l,value:c="",placement:r}=e.dataset;return new n.default({el:e,name:"NotificationEmailListboxInputRoot"+(i+1),provide:{label:o,name:a,emails:JSON.parse(e.dataset.emails),emptyValueText:l,value:c,disabled:Object(s.G)(e.dataset.disabled),placement:r},render:i=>i(x,{class:e.className.replace(t,"").trim()})})}))}();const t=document.querySelectorAll(".js-vue-notification-dropdown");return!!t.length&&t.forEach((function(t){const{containerClass:e,buttonSize:i,disabled:o,dropdownItems:a,notificationLevel:l,helpPagePath:c,projectId:r,groupId:d,showLabel:u,noFlip:p}=t.dataset;return new n.default({el:t,provide:{containerClass:e,buttonSize:i,disabled:Object(s.G)(o),dropdownItems:JSON.parse(a),initialNotificationLevel:l,helpPagePath:c,projectId:r,groupId:d,showLabel:Object(s.G)(u),noFlip:Object(s.G)(p)},render:t=>t(O)})}))}},uNj4:function(t,e,i){"use strict";i("v2fZ"),i("aFm2"),i("z6RN"),i("R9qC"),i("UezY"),i("hG7+"),i("3UXl"),i("iyoE"),i("FMw2"),i("B++/"),i("47t/");var o=i("l5WF"),n=i("crTv"),s=i("/lV4");var a={i18n:{noResultsText:Object(s.a)("No results found")},components:{GlFormGroup:o.a,GlCollapsibleListbox:n.a},model:n.a.model,props:{label:{type:String,required:!1,default:""},description:{type:String,required:!1,default:""},name:{type:String,required:!0},defaultToggleText:{type:String,required:!1,default:""},selected:{type:String,required:!1,default:null},items:{type:n.a.props.items.type,required:!0},disabled:{type:Boolean,required:!1,default:!1},fluidWidth:{type:n.a.props.fluidWidth.type,required:!1,default:n.a.props.fluidWidth.default},placement:{type:n.a.props.placement.type,required:!1,default:n.a.props.placement.default},block:{type:n.a.props.block.type,required:!1,default:n.a.props.block.default},toggleClass:{type:[Array,String,Object],required:!1,default:null}},data:()=>({searchString:""}),computed:{wrapperComponent(){return this.label||this.description?"gl-form-group":"div"},allOptions(){const t=[],e=function(i){for(let o=0;o<i.length;o+=1){const n=i[o];n.options?e(n.options):t.push(n)}};return e(this.items),t},isGrouped(){return this.items.some((function(t){return void 0!==t.options}))},isSearchable(){return this.allOptions.length>10},filteredItems(){const t=this.searchString.toLowerCase();return t?this.isGrouped?this.items.map((function({text:e,options:i}){return{text:e,options:i.filter((function(e){return e.text.toLowerCase().includes(t)}))}})).filter((function({options:t}){return t.length})):this.items.filter((function(e){return e.text.toLowerCase().includes(t)})):this.items},toggleText(){var t,e=this;return this.selected?null===(t=this.allOptions.find((function(t){return t.value===e.selected})))||void 0===t?void 0:t.text:this.defaultToggleText}},methods:{search(t){this.searchString=t}}},l=i("tBpV"),c=Object(l.a)(a,(function(){var t=this,e=t._self._c;return e(t.wrapperComponent,t._b({tag:"component",attrs:{label:t.label,description:t.description}},"component",t.$attrs,!1),[e("gl-collapsible-listbox",{attrs:{selected:t.selected,"toggle-text":t.toggleText,"toggle-class":t.toggleClass,items:t.filteredItems,searchable:t.isSearchable,"no-results-text":t.$options.i18n.noResultsText,disabled:t.disabled,"fluid-width":t.fluidWidth,placement:t.placement,block:t.block},on:{search:t.search,select:function(e){return t.$emit(t.$options.model.event,e)}}}),t._v(" "),e("input",{ref:"input",attrs:{type:"hidden",name:t.name},domProps:{value:t.selected}})],1)}),[],!1,null,null,null);e.a=c.exports}}]);
//# sourceMappingURL=commons-pages.groups.details-pages.groups.show-pages.profiles.notifications.show-pages.projects.show.131e0452.chunk.js.map